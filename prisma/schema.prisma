generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model WaitList {
  id        String   @id @default(uuid())
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Devlogs {
  id                 String   @id @default(uuid())
  title              String   @unique
  slug               String   @unique
  content            String
  coverImage         String?
  publishedDate      DateTime @default(now())
  updatedDate        DateTime @updatedAt
  tags               String[]
  categories         String[]
  readingTime        Int?
  excerpt            String?
  seoTitleTag        String?
  seoMetaDescription String?
  seoCanonicalUrl    String?
  ogTitle            String?
  ogDescription      String?
  ogImage            String?
  twitterCard        String?
  twitterTitle       String?
  twitterDescription String?
  twitterImage       String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model User {
  id                String    @id
  email             String    @unique
  name              String?
  username          String?   @unique
  level             String?   @default("beginner")
  preferredIde      String?   @default("vscode")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  githubAccessToken String?
  githubAvatarUrl   String?
  githubConnectedAt DateTime?
  githubEmail       String?
  githubId          String?   @unique
  githubUsername    String?
  isGithubConnected Boolean   @default(false)
  chats             Chat[]
}

model Chat {
  id             String          @id @default(uuid())
  userId         String
  messages       Json[]
  title          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  architecture   Architecture?
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  contextualDocs ContextualDocs?
}

model Architecture {
  id                    String   @id @default(uuid())
  chatId                String   @unique
  domain                String?
  complexity            String?
  architectureRationale String?
  components            Json
  connectionLabels      Json?
  componentPositions    Json?
  requirement           String?
  generatedAt           DateTime @default(now())
  lastPositionUpdate    DateTime @default(now())
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  chat                  Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

model ContextualDocs {
  id                         String   @id @default(uuid())
  chatId                     String   @unique
  projectRules               String?
  humanReview                String?
  plan                       String?
  prd                        String?
  bugTracking                String?
  projectStructure           String?
  uiUX                       String?
  phases                     Json?
  phaseCount                 Int?
  requirement                String?
  generatedAt                DateTime @default(now())
  lastDocUpdate              DateTime @default(now())
  isProjectRulesComplete     Boolean  @default(false)
  isHumanReviewComplete      Boolean  @default(false)
  isPlanComplete             Boolean  @default(false)
  isPrdComplete              Boolean  @default(false)
  isBugTrackingComplete      Boolean  @default(false)
  isProjectStructureComplete Boolean  @default(false)
  isUiUXComplete             Boolean  @default(false)
  arePhasesComplete          Boolean  @default(false)
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  chat                       Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
}

model Feedback {
  id        String   @id @default(uuid())
  userId    String
  chatId    String
  feedback  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
